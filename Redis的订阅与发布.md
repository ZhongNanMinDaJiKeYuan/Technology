###  订阅与发布
Redis服务器和客户端通过PUBLISH和SUBSCRIBE命令来实现订阅和发布模式。订阅和发布模式提供了两种信息传播机制：订阅/发布到频道和订阅/发布到模式。

#### 1 订阅/发布到频道
Redis的SUBSCRIBE命令可以让客户端定义多个频道，同一个频道也可以被多个客户端订阅，当服务器发送新的信息到被订阅的频道中时，客户端就能从频道中获取该信息。

订阅频道：Redis服务器进程维持着一个redisServer结构，结构中包含一个pub_channels字典，字典的键就是被订阅的频道，字典的值是一个链表用来存储订阅该频道的客户端。客户端调用SUBSCRIBE命令时，Redis系统就将该客户端链入到链表的尾部， 从而使客户端和频道关联。通过这样的结构我们可以很容易判断某一个频道是否被订阅，以及遍历订阅了一个频道的所有客户端。

发送信息到频道：当调用 PUBLISH channel message 命令，程序首先根据 channel 定位到字典的键，然后将信息发送给字典值链表中的所有客户端。

退订频道：使用*UNSUBSCRIBE*命令可以按照订阅的反操作将客户端从指定频道中删除，该客户端退订频道，无法再从频道中获取信息。

#### 2 订阅/发布到模式

当PUBLISH命令发送到某一个频道的时候，如果这个频道和模式匹配的话，新的信息不仅会被发送到这个频道中，还会发送到这个模式中，那么所有订阅了这个频道和订阅了模式的客户端都能收到信息。

订阅模式：redisServer.pubsub_patterns 属性是一个链表，链表中保存着所有和模式相关的信息，链表中的每一个节点都包含一个redis.h/pubsubPattern 结构，redis.h/pubsubPattern 结构保存着订阅模式的客户端和模式。

发布信息到模式：Redis系统会先遍历所有订阅的频道并将信息发送到频道中，然后取出所有的模式，如果频道和模式匹配，那么就将信息发送到订阅了这个模式的客户端。

退订模式：使用 *PUNSUBSCRIBE* 命令可以退订指定的模式，这个命令执行的是订阅模式的反操作：程序会删除 redisServer.pubsub_patterns 链表中，所有和被退订模式相关联的 pubsubPattern结构，这样客户端就不会再收到和模式相匹配的频道发来的信息。



